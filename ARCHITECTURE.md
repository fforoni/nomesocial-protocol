# nome.social Protocol Architecture (en)

This document describes the data flow and interaction between the components of the `nome.social` protocol. The architecture is designed to be secure, scalable, and efficient, leveraging managed services to accelerate the MVP development.

## Flow Diagram


```
[User at Frontend] --(1. Requests Name)--> [Backend]
^ |
| | (2. Generates PIX QR Code)
| |
+-------(3. Pays R$0.01 via Bank App)------+
|
|
[Third-party PIX API] --(4. Sends Webhook)--> [Backend]
|
|    (5. Validates CPF, Checks Uniqueness)
|
+----(6. Calls API)----> [ENS.node Service]
|
+--> [Smart Contracts on Base L2]
|
+--> [SBT Contract: Mints the SBT]
|
+--> [NameKit Registrar: Registers user.nomes.eth]
```


## Component Details

### 1. Frontend (Next.js / Vercel)
* **Responsibility:** User Interface.
* **Functions:** Connects to the user's wallet (e.g., MetaMask, Coinbase Wallet), displays the PIX QR Code generated by the backend, and checks on-chain if the SBT and subdomain have been created to confirm the registration's success and provide feedback to the user.

### 2. Backend (Node.js)
* **Responsibility:** Orchestration and business logic.
* **Functions:**
    * **Secure API:** Exposes endpoints for the frontend.
    * **PIX Integration:** Integrates with a PIX payment API to generate charges and receive confirmation webhooks.
    * **Verification Logic:** Contains the logic to validate the uniqueness of the payer's CPF by checking an internal database to prevent duplicate registrations.
    * **On-Chain Integration:** Instead of managing a hot wallet and transaction complexity, the backend makes a secure API call to the **ENS.node** service.

### 3. On-Chain Infrastructure (Base L2 / ENS.node)
* **Responsibility:** Registration and persistence of digital assets.
* **Components:**
    * **ENS.node:** A managed API service that abstracts away the complexity of direct interaction with the smart contracts. Our backend uses it to trigger subdomain registrations and SBT minting.
    * **`nomes.eth` Registrar:** The smart contract, based on NameKit and managed via ENS.node, which controls the registration and renewal rules for the subdomains.
    * **`BrazilianVerified.sbt`:** The Soulbound Token contract that issues the on-chain identity certificate for verified users.

---

# Arquitetura do Protocolo nome.social (pt-br)

Este documento descreve o fluxo de dados e a interação entre os componentes do `nome.social`. A arquitetura foi projetada para ser segura, escalável e eficiente, alavancando serviços gerenciados para acelerar o desenvolvimento do MVP.

## Diagrama de Fluxo


```
[Usuário no Frontend] --(1. Solicita Nome)--> [Backend]
^ |
| | (2. Gera QR Code PIX)
| |
+-------(3. Paga R$0,01 com App do Banco)-----+
|
|
[API PIX de Terceiros] --(4. Envia Webhook)--> [Backend]
|
|    (5. Valida CPF, Checa Unicidade)
|
+----(6. Chama API)----> [ENS.node Service]
|
+--> [Smart Contracts na Base L2]
|
+--> [SBT Contract: Minta o SBT]
|
+--> [NameKit Registrar: Registra usuario.nomes.eth]
```


## Detalhes dos Componentes

### 1. Frontend (Next.js / Vercel)
* **Responsabilidade:** Interface do usuário.
* **Funções:** Conecta com a carteira do usuário (ex: MetaMask, Coinbase Wallet), exibe o QR Code PIX gerado pelo backend e verifica on-chain se o SBT e o subdomínio foram criados para confirmar o sucesso do registro e dar feedback ao usuário.

### 2. Backend (Node.js)
* **Responsabilidade:** Orquestração e lógica de negócio.
* **Funções:**
    * **API Segura:** Expõe endpoints para o frontend.
    * **Integração PIX:** Integra-se com uma API de pagamentos PIX para gerar cobranças e receber webhooks de confirmação.
    * **Lógica de Verificação:** Contém a lógica para validar a unicidade do CPF do pagador, consultando um banco de dados interno para prevenir registros duplicados.
    * **Integração On-Chain:** Em vez de gerenciar uma "hot wallet" e a complexidade de transações, o backend faz uma chamada de API segura para o **ENS.node**.

### 3. Infraestrutura On-Chain (Base L2 / ENS.node)
* **Responsabilidade:** Registro e persistência dos ativos digitais.
* **Componentes:**
    * **ENS.node:** Um serviço de API gerenciado que abstrai a complexidade da interação direta com os smart contracts. Nosso backend o utiliza para acionar o registro de subdomínios e o mint do SBT.
    * **Registrador `nomes.eth`:** O contrato inteligente, baseado no NameKit e gerenciado via ENS.node, que controla as regras de registro e renovação dos subdomínios.
    * **`BrazilianVerified.sbt`:** O contrato do Soulbound Token que emite o certificado de identidade on-chain para os usuários verificados.